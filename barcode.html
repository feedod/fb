---
layout: default
---

<main class="container" x-data="barcodeApp">
  <h1>Генератор штрихкодов EAN-13</h1>

  <!-- Поле ввода -->
  <p>
    <input
      type="number"
      id="barcodeInput"
      placeholder="Введите данные для EAN-13"
      x-model="inputValue"
      style="width: 100%; padding: 0.6em; font-size: 1em; box-sizing: border-box;"
    >
  </p>

  <!-- Ошибка -->
  <p
    id="invalid-helper"
    x-show="error"
    x-text="errorMessage"
    style="color: red; font-size: 0.9em; display: none;"
  ></p>

  <!-- Кнопка генерации -->
  <p>
    <button
      @click="handleGenerate"
      style="width: 100%; padding: 0.7em; font-size: 1em; cursor: pointer;"
    >
      Сгенерировать
    </button>
  </p>

  <!-- Штрихкод -->
  <div style="text-align: center; margin-top: 1em;">
    <img
      x-show="barcodeUrl"
      :src="barcodeUrl"
      style="width: 100%; max-width: 600px; height: 150px; display: inline-block;"
    >
  </div>
</main>

<!-- Alpine.js -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  document.addEventListener("alpine:init", () => {
    Alpine.data("barcodeApp", () => ({
      inputValue: "",
      barcodeUrl: "",
      error: false,
      errorMessage: "",

      async handleGenerate() {
        // Оставляем только цифры
        const sanitized = this.inputValue.replace(/\D/g, "");

        if (!sanitized) {
          this.error = true;
          this.errorMessage = "Поле не может быть пустым";
          this.barcodeUrl = "";
          return;
        }

        // Сбрасываем ошибку перед запросом
        this.error = false;
        this.errorMessage = "";

        try {
          // Формируем URL для генерации EAN-13 через QuickChart API
          const url = `https://quickchart.io/barcode?type=ean13&text=${encodeURIComponent(sanitized)}&width=600&height=150`;

          // Проверка доступности API (HEAD запрос)
          const response = await fetch(url, { method: "HEAD" });
          if (!response.ok) {
            throw new Error("API вернул ошибку при генерации штрихкода");
          }

          // Отображаем штрихкод
          this.barcodeUrl = url;

          // Очищаем поле после успешной генерации
          this.inputValue = "";

        } catch (err) {
          this.error = true;
          this.barcodeUrl = "";
          this.errorMessage = err.message || "Произошла ошибка при генерации штрихкода";
        }
      }
    }));
  });

  // Telegram WebApp
  if (window.Telegram?.WebApp) {
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    tg.BackButton.show();
    tg.BackButton.onClick(() => window.location.href = "index.html");
    tg.CloseButton.hide();
  }
</script>