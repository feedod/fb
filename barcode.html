---
layout: default
---

<main class="container" x-data="barcodeApp">
  <h1>Генератор штрихкодов EAN-13</h1>

  <!-- Поле ввода -->
  <p>
    <input
      type="number"
      id="barcodeInput"
      placeholder="Введите 12 или 13 цифр"
      x-model="inputValue"
      style="width: 100%; padding: 0.6em; font-size: 1em; box-sizing: border-box;"
    >
  </p>

  <!-- Ошибка -->
  <p
    id="invalid-helper"
    x-show="error"
    x-text="errorMessage"
    style="color: red; font-size: 0.9em; display: none;"
  ></p>

  <!-- Кнопка -->
  <p>
    <button
      @click="handleGenerate"
      style="width: 100%; padding: 0.7em; font-size: 1em; cursor: pointer;"
    >
      Сгенерировать
    </button>
  </p>

  <!-- Штрихкод -->
  <div style="text-align: center; margin-top: 1em;">
    <img
      x-show="barcodeUrl"
      :src="barcodeUrl"
      style="width: 100%; max-width: 600px; height: 150px; display: inline-block;"
    >
  </div>
</main>

<!-- Alpine.js -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  document.addEventListener("alpine:init", () => {
    Alpine.data("barcodeApp", () => ({
      inputValue: "",
      barcodeUrl: "",
      error: false,
      errorMessage: "Введите ровно 12 или 13 цифр",

      // Генерация по кнопке
      handleGenerate() {
        this.inputValue = this.inputValue.replace(/\D/g, ""); // оставляем только цифры

        if (!/^\d{12,13}$/.test(this.inputValue)) {
          this.error = true;
          this.barcodeUrl = "";
          return;
        }

        this.error = false;
        this.generateBarcode();

        // очищаем поле только при успехе
        this.inputValue = "";
      },

      // Запрос к API для генерации штрихкода
      generateBarcode() {
        this.barcodeUrl =
          `https://quickchart.io/barcode?` +
          `type=ean13&text=${encodeURIComponent(this.inputValue)}&width=600&height=150`;
      }
    }));
  });

  // Поддержка Telegram WebApp
  if (window.Telegram?.WebApp) {
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    tg.BackButton.show();
    tg.BackButton.onClick(() => (window.location.href = "index.html"));
    tg.CloseButton.hide();
  }
</script>