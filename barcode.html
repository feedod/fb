---
layout: default
---

<main class="container">
  <h1>Генератор штрихкодов EAN</h1>

  <p>
    <input
      type="text"
      id="barcodeInput"
      name="number"
      placeholder="Введите цифры"
      style="width: 100%; padding: 0.5em; font-size: 1em; box-sizing: border-box;"
      pattern="\d*"
      inputmode="numeric"
    >
  </p>

  <p>
    <button
      id="generateButton"
      style="width: 100%; padding: 0.5em; font-size: 1em; cursor: pointer;"
    >
      Сгенерировать
    </button>
  </p>

  <p id="invalid-helper" style="color: red; font-size: 0.9em; display: none;">
    Введите только цифры
  </p>

  <div style="text-align: center; margin-top: 1em;">
    <img
      id="barcodeImage"
      style="width: 100%; height: auto; display: inline-block;"
      alt="Сгенерированный штрихкод"
    >
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  (function() {
    const input = document.getElementById("barcodeInput");
    const button = document.getElementById("generateButton");
    const img = document.getElementById("barcodeImage");
    const invalidHelper = document.getElementById("invalid-helper");

    /**
     * Генерация штрихкода EAN через Canvas и отображение в <img>
     * @param {string} value
     */
    const generateBarcode = value => {
      const canvas = document.createElement("canvas");
      const containerWidth = img.clientWidth;
      const barWidth = Math.max(containerWidth / (value.length * 8), 1);
      const fontSize = Math.min(20, 150 / 7);

      JsBarcode(canvas, value, {
        format: "EAN13",
        displayValue: true,
        textAlign: "center",
        fontSize: fontSize,
        textMargin: 5,
        width: barWidth,
        height: 150,
        margin: 0
      });

      img.src = canvas.toDataURL("image/png");
    };

    /**
     * Проверка, что ввод содержит только цифры
     * @param {string} value
     * @returns {boolean}
     */
    const validateInput = value => /^\d+$/.test(value);

    // Обработчик кнопки
    button.addEventListener("click", () => {
      const value = input.value.trim();

      if (value === "" || !validateInput(value)) {
        img.src = "";
        invalidHelper.style.display = "block";
        return;
      }

      generateBarcode(value);
      invalidHelper.style.display = "none";
      input.value = "";
    });

    // Настройка Telegram Web App
    if (window.Telegram?.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();

      tg.BackButton.show();
      tg.BackButton.onClick(() => {
        window.location.href = "index.html";
      });
      tg.CloseButton.hide();
    }
  })();
</script>