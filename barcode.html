---
layout: default
---

<main class="container">
  <h1>Генератор штрихкодов EAN-13</h1>

  <p>
    <input
      type="number"
      id="barcodeInput"
      name="number"
      placeholder="Введите 12 или 13 цифр"
      min="100000000000"
      max="9999999999999"
      style="width: 100%; padding: 0.5em; font-size: 1em; box-sizing: border-box;"
    >
  </p>

  <p id="invalid-helper" style="color: red; font-size: 0.9em; display: none;">
    Введите ровно 12 или 13 цифр
  </p>

  <div style="text-align: center; margin-top: 1em;">
    <svg
      id="barcodeSVG"
      style="width: 100%; height: 150px; display: inline-block;"
    ></svg>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  (() => {
    "use strict";

    const input = document.getElementById("barcodeInput");
    const svg = document.getElementById("barcodeSVG");
    const invalidHelper = document.getElementById("invalid-helper");

    /**
     * Генерация штрихкода EAN-13 через JsBarcode
     * @param {string} value
     */
    const generateBarcode = (value) => {
      const containerWidth = svg.clientWidth;
      const barWidth = Math.max(containerWidth / (value.length * 10), 1);

      JsBarcode(svg, value, {
        format: "EAN13",
        displayValue: true,
        textAlign: "center",
        width: barWidth,
        height: 150,
        margin: 0
      });
    };

    /**
     * Проверка корректности ввода (12–13 цифр)
     * @param {string} value
     */
    const validateInput = (value) => {
      if (!value) {
        svg.innerHTML = "";
        invalidHelper.style.display = "none";
        return false;
      }

      const isValid = /^\d{12,13}$/.test(value);
      if (!isValid) {
        svg.innerHTML = "";
        invalidHelper.style.display = "block";
      } else {
        invalidHelper.style.display = "none";
        generateBarcode(value);
      }
      return isValid;
    };

    // Обработчик ввода: только цифры
    input.addEventListener("input", () => {
      input.value = input.value.replace(/\D/g, ""); // удаляем все нецифры
      validateInput(input.value.trim());
    });

    // Настройка кнопок Telegram Web App
    if (window.Telegram?.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();

      tg.BackButton.show();
      tg.BackButton.onClick(() => window.location.href = "index.html");
      tg.CloseButton.hide();
    }
  })();
</script>